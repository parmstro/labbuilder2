#cloud-config
password: {{ baseimage_password }}
ssh_pwauth: True
users:
  - default
  - name: ansible-runner 
    groups: users,wheel
    sudo: ["ALL=(ALL) NOPASSWD:ALL"]
    ssh_pwauth: True
    ssh_authorized_keys:
      - {{ cloudint_ssh_key }}
chpasswd:
  list: |
    root:{{ baseimage_password }}
    cloud-user:{{ baseimage_password }}
    ansible-runner:{{ baseimage_password }}
  expire: False
runcmd:
  - nmcli conn mod "System eth0" ipv4.method static ipv4.address {{ sat_ip }}/{{ sat_prefix }} ipv4.gateway {{ sat_gateway }} ipv4.dns {{ sat_dns }}
  - hostnamectl set-hostname {{ sat_fqdn }}
  - nmcli conn up "System eth0"
  - echo {{ idm_fqdn }} {{ idm_ip }} >> /etc/hosts
  - echo {{ sat_fqdn }} {{ sat_ip }} >> /etc/hosts
  - subscription-manager register --force --org={{ sat_rhsm_org }} --activationkey={{ sat_activationkey }}
